<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Hub Connection</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsonlint/1.6.0/jsonlint.min.js"></script>
    <script scr="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.0/axios.min.js"></script>
    <script>
        window.onload = async function () {
            document.getElementById("send_button").onclick = function () {
                try {
                    let str_res = document.getElementById("source").value;
                    let result = jsonlint.parse(document.getElementById("source").value);
                    if (result) {
                        document.getElementById("result").innerHTML = "JSON is valid!";
                        document.getElementById("result").className = "pass";
                        if (document.getElementById("reformat").checked) {
                            document.getElementById("source").value = JSON.stringify(result, null, "  ");
                        }
                        fetch('/socket_send', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: str_res
                        })
                            .then((response) => {
                                return response.json();
                            })
                            .then((data) => {
                                console.log(data);
                            })
                            .catch((error) => {
                                console.log(error);
                            })

                    }
                } catch (e) {
                    document.getElementById("result").innerHTML = e;
                    document.getElementById("result").className = "fail";
                }
            };

            document.getElementById("connect_button").onclick = function () {
                document.getElementById("connect_button").disabled = true;
                fetch('/create_socket_client', {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                })
                    .then((response) => {
                        return response.json();
                    })
                    .then((data) => {
                        console.log(data);
                    })
                    .catch((error) => {
                        console.log(error);
                    })
            };

        }
    </script>
    <style>
        body {
            font-family: sans-serif;
        }

        #result {
            padding: 1em;
            max-width: 550px;
        }

        .pass {
            background-color: #efe;
            color: #393;
            border: 2px solid #393;
        }

        .fail {
            background-color: #fee;
            color: #933;
            border: 2px solid #933;
        }

        #send_button {
            padding: 5px 20px;
        }

        .con_discon {
            padding: 10px 0px;
        }

        table,
        th,
        td {
            border: 1px solid black;
            border-collapse: collapse;
            padding: 5px 10px;
        }
    </style>
</head>

<body>
    <div class="con_discon">
        <button id="connect_button">Connect</button>
        <button id="disconnect_button">Disconnect</button>
    </div>
    <textarea id="source" rows="10" cols="30"></textarea>
    <div>
        <button id="send_button">Send</button>
        <input type="checkbox" value="yes" id="reformat"><label for="reformat">reformat JSON</label>
    </div>

    <pre id="result" class="pass">JSON is valid!</pre>
    <table>
        <thead></thead>
        <col>
        <colgroup span="2"></colgroup>
        <colgroup span="2"></colgroup>
        <tr>
            <th colspan="2" scope="colgroup">Client</th>
            <th colspan="2" scope="colgroup">Server</th>
        </tr>
        <tr>
            <th scope="col">Request</th>
            <th scope="col">Response</th>
            <th scope="col">Request</th>
            <th scope="col">Response</th>
        </tr>
        </thead>
        <tbody></tbody>
    </table>
</body>
</body>

</html>